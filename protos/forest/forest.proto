syntax = "proto3";

option go_package = "github.com/jdk829355/InForest_back/protos/forest";

service ForestService {
  rpc GetForestsByUser (GetForestsByUserRequest) returns (GetForestsByUserResponse);
  rpc GetForest (GetForestRequest) returns (GetForestResponse);
  rpc GetTree (GetTreeRequest) returns (Tree);

  rpc CreateForest (CreateForestRequest) returns (Forest);
  rpc CreateTree (CreateTreeRequest) returns (CreateTreeResponse);
  
  rpc UpdateForest (UpdateForestRequest) returns (Forest);
  rpc UpdateTree (UpdateTreeRequest) returns (Tree);

  rpc DeleteForest (DeleteForestRequest) returns (DeleteForestResponse);
  rpc DeleteTree (DeleteTreeRequest) returns (DeleteTreeResponse);

  rpc UpdateMemo (UpdateMemoRequest) returns (UpdateMemoResponse);
  rpc GetMemo (GetMemoRequest) returns (Memo);

  rpc GetSummary (GetSummaryRequest) returns (stream GetSummaryResponse);
}

message GetSummaryRequest {
    string tree_id = 1;
}

message GetSummaryResponse {
    string summary = 1;
    string status = 2;
}

message GetForestsByUserRequest {
    bool include_children = 1;
}

message Tree {
    string id = 1;
    string name = 2;
    string url = 3;
    repeated Tree children = 4;
    string summary = 5;
}

message CreateTreeResponse {
    Tree tree = 1;
    Memo memo = 2;
}

message CreateTreeRequest {
    string id = 1;
    string name = 2;
    string url = 3;
    string parent_id = 4;
}

message Forest {
    Tree root = 1;
    string id = 2;
    string name = 3;
    string description = 4;
    int32 depth = 5;
    int32 total_trees = 6;
    string user_id = 7;
}

message CreateForestRequest {
    string name = 1;
    string description = 2;
    Tree root = 4;
}

message GetForestsByUserResponse {
    repeated Forest forests = 1;
}

message GetForestRequest {
    string forest_id = 1;
    bool include_children = 2;
}

message GetForestResponse {
    Forest forest = 1;
}

message UpdateForestRequest {
    string forest_id = 1;
    string name = 2;
    string description = 3;
}

// Forest 삭제 RPC
message DeleteForestRequest {
    string forest_id = 1;
}
message DeleteForestResponse {
    bool success = 1;
}
message UpdateTreeRequest {
    string tree_id = 1;
    string name = 2;
    string url = 3;
}

message DeleteTreeRequest {
    string tree_id = 1;
    bool cascade = 2;
}

message DeleteTreeResponse {
    bool success = 1;
}
message GetTreeRequest {
    string tree_id = 1;
    bool include_children = 2;
}

message Memo {
    string tree_id = 1;
    string content = 2;
    int32 version = 3;
}

message UpdateMemoRequest {
    Memo memo = 1;
    bool force = 2;
}
message UpdateMemoResponse {
    bool success = 1;
    Memo new_memo = 2;
    string synced_at = 3;
}

message GetMemoRequest {
    string tree_id = 1;
}