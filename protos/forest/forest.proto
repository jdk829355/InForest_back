syntax = "proto3";

option go_package = "github.com/jdk829355/InForest_back/protos/forest";


/* 
TODO 아래에 있는 RPC 추가
- GetForestsByUser: 특정 사용자의 모든 숲을 가져오는 RPC (인증 기능 완료)
- CreateForest: 새로운 숲을 생성하는 RPC (인증 기능 완료)
- CreateTree: 숲에 새로운 나무를 추가하는 RPC (user_id 안 쓰니 인증 기능 필요 없음)
- GetForest: 특정 숲의 세부 정보를 가져오는 RPC (user_id 안 쓰니 인증 기능 필요 없음)
- UpdateForest: 특정 숲의 정보를 업데이트하는 RPC (구현 완료)
- DeleteForest: 특정 숲을 삭제하는 RPC (구현 완료)
- UpdateTree: 특정 나무의 정보를 업데이트하는 RPC (구현 완료)
- GetTree: 특정 나무의 세부 정보를 가져오는 RPC (구현 완료)
- DeleteTree: 특정 나무를 삭제하는 RPC (구현 완료)
- GetMemo: Tree의 메모 요청하는 RPC 
- UpdateMemo: Tree의 메모를 업데이트하는 RPC 
*/

 /* ForestService는 숲과 나무에 대한 CRUD 작업을 처리합니다.
*/
service ForestService {
  rpc GetForestsByUser (GetForestsByUserRequest) returns (GetForestsByUserResponse);
  rpc GetForest (GetForestRequest) returns (GetForestResponse);
  rpc GetTree (GetTreeRequest) returns (Tree);

  rpc CreateForest (CreateForestRequest) returns (Forest);
  rpc CreateTree (CreateTreeRequest) returns (CreateTreeResponse);
  
  rpc UpdateForest (UpdateForestRequest) returns (Forest);
  rpc UpdateTree (UpdateTreeRequest) returns (Tree);

  rpc DeleteForest (DeleteForestRequest) returns (DeleteForestResponse);
  rpc DeleteTree (DeleteTreeRequest) returns (DeleteTreeResponse);

  rpc UpdateMemo (UpdateMemoRequest) returns (UpdateMemoResponse);
  rpc GetMemo (GetMemoRequest) returns (Memo);
}

message GetForestsByUserRequest {
    bool include_children = 1;
}

message Tree {
    string id = 1;
    string name = 2;
    string url = 3;
    repeated Tree children = 4;
}

message CreateTreeResponse {
    Tree tree = 1;
    Memo memo = 2;
}

message CreateTreeRequest {
    string id = 1;
    string name = 2;
    string url = 3;
    string parent_id = 4;
}

message Forest {
    Tree root = 1;
    string id = 2;
    string name = 3;
    string description = 4;
    int32 depth = 5;
    int32 total_trees = 6;
    string user_id = 7;
}

message CreateForestRequest {
    string name = 1;
    string description = 2;
    Tree root = 4;
}

message GetForestsByUserResponse {
    repeated Forest forests = 1;
}

message GetForestRequest {
    string forest_id = 1;
    bool include_children = 2;
}

message GetForestResponse {
    Forest forest = 1;
}

message UpdateForestRequest {
    string forest_id = 1;
    string name = 2;
    string description = 3;
}

// Forest 삭제 RPC
message DeleteForestRequest {
    string forest_id = 1;
}
message DeleteForestResponse {
    bool success = 1;
}
message UpdateTreeRequest {
    string tree_id = 1;
    string name = 2;
    string url = 3;
}

message DeleteTreeRequest {
    string tree_id = 1;
    bool cascade = 2;
}

message DeleteTreeResponse {
    bool success = 1;
}
message GetTreeRequest {
    string tree_id = 1;
    bool include_children = 2;
}

message Memo {
    string tree_id = 1;
    string content = 2;
    int32 version = 3;
}

message UpdateMemoRequest {
    Memo memo = 1;
    int32 base_version = 2;
}
message UpdateMemoResponse {
    bool success = 1;
    Memo new_memo = 2;
    string synced_at = 3;
}

message GetMemoRequest {
    string tree_id = 1;
}